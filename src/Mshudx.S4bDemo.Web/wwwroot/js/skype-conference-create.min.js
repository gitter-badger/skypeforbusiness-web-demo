var client;$(function(){"use strict";function e(){i.conversationsManager.conversations.get().then(function(e){e&&e.length>0&&($("#status").text("Disconnecting existing conversations: "+e.length),e.forEach(function(e,n,t){console.log("Closing conversation: "+n),i.conversationsManager.conversations.remove(e)}))})}function n(){var e=i.conversationsManager.conversations.added(function(e){function n(){var n=e.participants(0).person.displayName();"Notified"==d.video.state()?confirm("Accept a video call from "+n+"?")?(console.log("accepting a video call"),s=r.accept(),monitor("Accepting video request from "+n,s)):confirm("Accept a video call from "+n+" with audio only?\n(You will still see the incoming video)")?(console.log("accepting a video call with audio"),c=a.accept(),monitor("Accepting audio request from "+n,c)):(console.log("declining the incoming video request"),r.reject()):"Notified"==d.audio.state()&&(confirm("Accept an audio call from "+n+"?")?(console.log("accepting the audio call"),c=a.accept(),monitor("Accepting audio call from "+n,c)):(console.log("declining the incoming audio request"),a.reject())),g=null}var t,o,a,c,r,s,d,v,g;d=e.selfParticipant,t=e.chatService,a=e.audioService,r=e.videoService,t.accept.enabled()&&(v=e.participants(0).person.displayName(),confirm("Accept incoming chat request from "+v+"?")?(console.log("accepting the incoming chat request"),o=t.accept(),monitor("Accepting chat request from "+v,o)):(console.log("declining the incoming chat request"),t.reject())),e.participants.added(function(e){e.video.state.changed(function(n,t,i){"Connected"==n&&e.video.channels(0).stream.source.sink.container(document.getElementById("renderWindow"))}),e.audio.state.changed(function(e,n,t){})}),d.audio.state.changed(function(e,t,i){"Notified"!=e||g||(g=setTimeout(n,0))}),d.video.state.changed(function(t,i,o){var a;"Notified"!=t||g?"Connected"==t&&(a=e.selfParticipant.video.channels(0),a.stream.source.sink.container.set(document.getElementById("previewWindow"))):g=setTimeout(n,0)}),e.state.changed(function l(n){"Disconnected"==n&&(e.state.changed.off(l),i.conversationsManager.conversations.remove(e))})});o.push(e)}function t(e,n){var t,o,a;return a=i.personsAndGroupsManager.createPersonSearchQuery(),a.text(n),a.getMore().then(function(n){t=n[0].result,o=e.createParticipant(t),e.participants.add(o),e.chatService.sendMessage("Hi, meeting now!")})}var i,o=o||[];o.forEach(function(e){e.dispose()}),o=[],Skype.initialize({apiKey:config.apiKey},function(t){i=new t.application,i.signInManager.state.changed(function(e){console.log(e)}),i.signInManager.signIn({client_id:config.client_id,origins:["https://webdir.online.lync.com/autodiscover/autodiscoverservice.svc/root"],cors:!0,redirect_uri:config.redirect_uri,version:config.version}).then(function(){e(),n()})},function(e){console.log(e),alert("Cannot load the SDK.")}),$(".contactAdd").click(function(){$(".add-p-container").toggleClass("hide")}),$("#btn-add-participant").click(function(){var e,n=i.conversationsManager.conversations(0),o=$("#txt-contact").val();n&&(e=t(n,o)),$(".av-controls").show(),$(".add-p-container").hide()}),$("#startChatMeeting").click(function(){var e,n,t=$("#meetingUri").text();e=i.conversationsManager.getConversationByUri(t),n=e.chatService.start().then(function(){e.chatService.sendMessage("Hi")})}),$("#startAudioMeeting").click(function(){var e,n,t=$("#meetingUri").text();e=i.conversationsManager.getConversationByUri(t),n=e.audioService.start()}),$("#startVideoMeeting").click(function(){var e,n,t=$("#meetingUri").text();e=i.conversationsManager.getConversationByUri(t),n=e.videoService.start()}),$("#startNewChatMeeting").click(function(){var e,n,t;e=i.conversationsManager.createConversation(),$("#newMeetingUri").val(""),n=e.chatService.start().then(function(){t=e.uri(),$("#newMeetingUri").val(t),$(".c-add-p-container").removeClass("hide")})}),$("#startNewAudioMeeting").click(function(){var e,n,t;e=i.conversationsManager.createConversation(),$("#newMeetingUri").val(""),n=e.audioService.start().then(function(){t=e.uri(),$("#newMeetingUri").val(t),$(".c-add-p-container").removeClass("hide")})}),$("#startNewVideoMeeting").click(function(){var e,n,t;e=i.conversationsManager.createConversation(),$("#newMeetingUri").val(""),n=e.videoService.start().then(function(){t=e.uri(),$("#newMeetingUri").val(t),$(".c-add-p-container").removeClass("hide")})}),$("#showRemoteVideoInMeeting").click(function(){var e,n,t;1==i.conversationsManager.conversations.size()&&(e=i.conversationsManager.conversations(0),n=e.participants(0).video.channels(0),n.stream.source.sink.container(document.getElementById("renderWindow")),t=n.isStarted.set(!0))}),$("#removeRemoteVideoInMeeting").click(function(){var e,n,t;1==i.conversationsManager.conversations.size()&&(e=i.conversationsManager.conversations(0),n=e.participants(0).video.channels(0),t=n.isStarted.set(!1))})});